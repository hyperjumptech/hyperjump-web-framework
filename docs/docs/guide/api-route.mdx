---
title: API Routes
---

Route handlers (API routes) should **not** be your first choice for communication between your own Next.js client components and server code.

- For read-heavy page data, prefer server-rendered data fetching.
- For data mutation from your own app UI, prefer Server Functions / Server Actions first.
- Use route handlers when you need an HTTP endpoint (third-party callers, cross-app clients, webhooks, or explicit fetch APIs).

When you do need route handlers, use `route-action-gen` instead of writing boilerplate manually.

## Generate, do not hand-write

In this codebase, the rule is:

1. you write `route.[method].config.ts`
2. `route-action-gen` generates the implementation files
3. you import from `.generated/` in entrypoint files

This keeps request/response contracts strongly typed and consistent across routes.

## CLI workflow

### 1) Create a config file

```bash
npx route-action-gen create post app/api/posts/[postId]
```

You can use any supported method: `get`, `post`, `put`, `delete`, `patch`, `options`, `head`.

### 2) Generate files

```bash
npx route-action-gen
```

By default, generated artifacts are written to a `.generated/` directory next to your config files.

### 3) Optional: create entrypoint files automatically

```bash
npx route-action-gen --with-entrypoint
```

Without `--with-entrypoint`, the generator prints which entrypoint file should exist.

## Framework support

`route-action-gen` supports:

- `next-app-router`
- `next-pages-router`
- `auto` (default, detects by directory)

For App Router routes, generated files live in:

`app/.../.generated/`

For Pages Router routes, generated files live in:

`.generated/pages/...`

## Config contract

Each `route.[method].config.ts` file must export:

- `requestValidator` from `createRequestValidator(...)`
- `responseValidator` as a Zod schema
- `handler` typed with `HandlerFunc<...>`

Example:

```ts title="app/api/posts/[postId]/route.post.config.ts" lineNumbers
import { z } from "zod";
import {
  createRequestValidator,
  type AuthFunc,
  type HandlerFunc,
  successResponse,
  errorResponse,
} from "route-action-gen/lib";

const auth: AuthFunc<{ id: string }> = async () => {
  const user = await getUser();
  if (!user) throw new Error("Unauthorized");
  return user;
};

export const requestValidator = createRequestValidator({
  body: z.object({
    title: z.string().min(1),
    content: z.string().min(1),
  }),
  params: z.object({ postId: z.string().min(1) }),
  searchParams: z.object({ preview: z.string().optional() }).optional(),
  headers: z.object({ authorization: z.string().optional() }).optional(),
  user: auth,
});

export const responseValidator = z.object({
  id: z.string().min(1),
});

export const handler: HandlerFunc<
  typeof requestValidator,
  typeof responseValidator,
  undefined
> = async (data) => {
  const { body, params, user } = data;
  if (!user) return errorResponse("Unauthorized", undefined, 401);

  const post = await updatePost(params.postId, {
    title: body.title,
    content: body.content,
    userId: user.id,
  });

  return successResponse({ id: post.id });
};
```

## What gets generated

Generated outputs depend on method and framework.

### Generated for all methods

- `route.ts`
- `client.ts`
- `use-route-[method].tsx`
- `README.md`

### Generated for body methods in App Router (`post`, `put`, `patch`)

- `server.function.ts`
- `form.action.ts`
- `use-server-function.tsx`
- `use-form-action.tsx`

### Generated when body/params fields exist

- `form-components.tsx`

> In Pages Router, server action files are not generated.

## Entry point files

Generated `route.ts` lives in `.generated/`, so you still need an entrypoint file in the route directory.

App Router entrypoint:

```ts title="app/api/posts/[postId]/route.ts" lineNumbers
export * from "./.generated/route";
```

Pages Router entrypoint:

```ts title="pages/api/posts/[postId]/index.ts" lineNumbers
export { default } from "../../../.generated/pages/api/posts/[postId]/route";
```

`--with-entrypoint` creates these files when missing (and does not overwrite existing ones).

## Calling the generated endpoint

In React client components, use generated hooks:

- `useRouteGet` for GET (auto fetch + refetch/cancel support)
- `useRoutePost` / `useRoutePut` / `useRoutePatch` / etc. for mutations

In non-React code, use generated `RouteClient` from `client.ts`.

## Ground rules

|     | Action                                                                                               |
| --- | ---------------------------------------------------------------------------------------------------- |
| ✅  | Write and review `route.[method].config.ts` manually.                                                |
| ✅  | Treat `.generated/*` as generated artifacts and regenerate when config changes.                      |
| ✅  | Use `--with-entrypoint` when you want automatic route/index file creation.                           |
| ✅  | Prefer Server Functions / Server Actions for same-app mutations unless an HTTP endpoint is required. |
